function Colors(){var e=["turquoise","magenta","yellow","orange","green","blue","red"],t=[],r=function(){return Math.floor(Math.random()*e.length)};this.randomColor=function(){for(var n=r();-1!==t.indexOf(e[n]);)n=r();return t.push(e[n]),e[n]}}function Tools(){var e="savedInputs",t=function(e){var t=parseFloat(e)||0;return 1>t?t:t/100},r=function(e){var t=e.split("/"),r=parseFloat(t[0])||0,n=parseFloat(t[1])||0;return r/n};this.convert=function(e){return"number"==typeof e?t(e):"string"==typeof e?-1===e.search("/")?t(e):r(e):void alert("Input error!")};var n=function(e,t,r){var n=new Date;n.setTime(n.getTime()+24*r*60*60*1e3);var s="expires="+n.toUTCString();document.cookie=e+"="+t+"; "+s};this.setCookie=function(e,t,r){n(e,t,r)};var s=function(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var s=r[n];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return""};this.getCookie=function(e){return s(e)},this.isSavedCookieSet=function(){var t=s(e);return""!=t?!0:!1},this.extract=function(e){var t=[],r=e.split("-"),n=parseInt(r[0])||0;t.push(n);var s=parseInt(r[1])||0;return t.push(s),t},this.separate=function(e){return e.split("-")},this.expressionsOnly=function(e){var t=e.which?e.which:e.keyCode;return 46!=t&&47!=t&&t>31&&(48>t||t>57)?!1:!0}}function Save(){var e="savedInputs",t="",r=30;this.set=function(n){t=n,tools.setCookie(e,t,r)},this.get=function(){t=tools.getCookie(e),courseList.setCourses(t.split("+"))}}function Entry(e,t,r,n){var s=e+"-"+t,i=e,o=t,a=0,c=0,u="",l=0,v=!1,h=!1;-1===r?(u=100,l=100):(u=r,l=r);var g='<span class="row-wrap" id="row-wrap-'+s+'">';g+='<div class="out-col" id="row-'+s+'">'+(o+1)+"</div>",g+='<input class="exp-col '+n+'-line" id="grade-'+s+'" type="text" value="0" onkeypress="return tools.expressionsOnly(event)">',g+='<input class="num-col '+n+'-line" id="weight-'+s+'" type="number" value="'+l+'" min="0" max="100">',g+='<div class="out-col">',-1!==r&&(g+='<span class="remove button glyphicon glyphicon-remove" id="close-'+s+'" data-close="'+s+'"></span>'),g+="</div>",g+="</span>",this.getPair=function(){return a+"-"+u},this.getProduct=function(){return c*l},this.remove=function(){$("#row-wrap-"+s).remove()},this.adjust=function(){var e=s;o--,s=i+"-"+o,$("#row-wrap-"+e).attr("id","row-wrap-"+s),$("#row-"+e).html(""+(o+1)),$("#row-"+e).attr("id","row-"+s),$("#grade-"+e).attr("id","grade-"+s),$("#weight-"+e).attr("id","weight-"+s),$("#close-"+e).attr("data-close",s),$("#close-"+e).attr("id","close-"+s)},this.setActive=function(){h||($(".exp-col, .num-col").click(function(){$(this).select()}),$("#grade-"+s).on("change keyup",function(){a=$(this).val(),courseList.saveCourses(),c=tools.convert($(this).val())||0,courseList.setAverage()}),$("#weight-"+s).on("change keyup",function(){u=$(this).val(),courseList.saveCourses(),l=parseFloat($(this).val())||0,courseList.setAverage()}),$("#close-"+s).click(function(){var e=tools.extract($(this).data("close"));courseList.removeEntry(e[0],e[1]),courseList.setAverage()}),h=!0)},this.create=function(){return v?void 0:(v=!0,g)},this.setGrade=function(e){$("#grade-"+s).val(e),$("#grade-"+s).change()},this.getGrade=function(){return c},this.setWeight=function(e){$("#weight-"+s).val(e),$("#weight-"+s).change()},this.getWeight=function(){return l},this.setCourse=function(e){i=e},this.getCourse=function(){return i}}function Course(e,t){var r=e,n=[],s=0,i=!1,o=!1,a='<div class="course '+t+'-0 centered" id="course-'+r+'">';a+='<input class="average '+t+'-2 centered" id="average-'+r+'" type="text" value="0.00%" readonly/>',a+='<div class="out-col"></div>',a+='<div class="exp-col head-col">G</div>',a+='<div class="num-col head-col">W</div>',a+='<div class="out-col"></div>',a+='<span id="initial-target-'+r+'"></span>',a+='<div class="add button '+t+"-button "+t+'-3 glyphicon glyphicon-plus" id="add-button-'+r+'"></div>',a+="</div>";var c=function(){for(var e=100,t=0;t<n.length;t++)e-=n[t].getWeight();return e},u=function(){var e,s;0===n.length?(e=new Entry(r,n.length,-1,t),s="#initial-target-"+r):(e=new Entry(r,n.length,c(),t),s="#row-wrap-"+r+"-"+(n.length-1)),$(s).after(e.create()),n.push(e),n[n.length-1].setActive()};this.saveEntries=function(){for(var e="",t=0;t<n.length;t++)e+=t!==n.length-1?n[t].getPair()+",":n[t].getPair();return e};var l=function(e,t,r){n[e].setGrade(t),n[e].setWeight(r)};this.setEntries=function(e){for(var t=0;t<e.length;t++){t>0&&$("#add-button-"+r).click();var n=tools.separate(e[t]);l(t,n[0],n[1])}},this.removeEntry=function(e){if(n[e].remove(),e!==n.length-1)for(var t=e+1;t<n.length;t++)n[t].adjust();n.splice(e,1)},this.setActive=function(){o||(u(),$("#add-button-"+r).click(function(){u()}),o=!0)},this.create=function(){return i?void 0:(i=!0,a)},this.setAverage=function(){s=0;for(var e=0;e<n.length;e++)s+=n[e].getProduct();$("#average-"+r).val(s.toFixed(2)+"%")},this.getAverage=function(){return s},this.getNumberOfEntries=function(){return n.length}}function ArrayOfCourses(){var e=5,t=[],r=0;this.addCourse=function(){if(t.length<e){var r=new Course(t.length,picker.randomColor());return t.push(r),t[t.length-1].create()}},this.saveCourses=function(){for(var e="",r=0;r<t.length;r++)e+=r!==t.length-1?t[r].saveEntries()+"+":t[r].saveEntries();save.set(e)},this.setCourses=function(e){for(var r=0;r<e.length;r++)r>0&&$("#add-course").click(),t[r].setEntries(e[r].split(","))},this.removeEntry=function(e,r){t[e].removeEntry(r)},this.setActive=function(){for(var e=0;e<t.length;e++)t[e].setActive()},this.setAverage=function(){for(var e=0,n=0;n<t.length;n++)t[n].setAverage(),e+=t[n].getAverage();r=e/t.length,$("#average-bubble").val(r.toFixed(2)+"%")},this.getAverage=function(){return r},this.getNumberOfCourses=function(){return t.length}}var picker=new Colors,tools=new Tools,save=new Save,courseList=new ArrayOfCourses;$(function(){$("#average-bubble").val("0.00%"),$("#save-alert").css("display","none"),$("#container").html(courseList.addCourse()),courseList.setActive(),tools.isSavedCookieSet()&&$("#save-alert").css("display","block"),$("#restore-results").click(function(){save.get(),$("#close-alert").click()}),$("#add-course").click(function(){var e="#course-"+(courseList.getNumberOfCourses()-1);$(e).after(courseList.addCourse()),courseList.setActive()}),$("#feedback").on("submit",function(e){e.preventDefault(),$.ajax({url:$(this).attr("action"),type:"POST",data:$(this).serialize(),beforeSend:function(){},success:function(e){$("#feedback-close").click(),$("#success-trigger").click()}})})});